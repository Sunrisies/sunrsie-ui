<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>相机控制测试 - Cesium 工具库</title>
    <link rel="stylesheet" href="css/style.css" />
    <script src="cesium/Cesium.js"></script>
    <link href="cesium/widgets.min.css" rel="stylesheet" />
    <script src="../dist/index.global.js"></script>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>相机控制测试</h1>
        <p>测试相机飞行、跳转、获取当前位置等相机控制功能</p>
        <a href="index.html" class="back-btn">← 返回主页面</a>
      </header>

      <div class="content">
        <div id="cesiumContainer"></div>

        <div class="control-panel">
          <div class="section">
            <h2 class="section-title">相机控制测试</h2>

            <div class="input-group">
              <label>飞行到指定位置</label>
              <div class="coordinates">
                <input
                  type="number"
                  id="flyLon"
                  placeholder="经度"
                  value="116.3974"
                  step="0.0001"
                />
                <input
                  type="number"
                  id="flyLat"
                  placeholder="纬度"
                  value="39.9093"
                  step="0.0001"
                />
              </div>
              <input
                type="number"
                id="flyHeight"
                placeholder="高度(米)"
                value="1000"
                step="100"
              />
              <div class="button-group">
                <button id="flyToBtn">飞行到位置</button>
                <button id="setViewBtn">立即跳转</button>
              </div>
            </div>

            <div class="input-group">
              <label>预设位置</label>
              <select id="presetLocations">
                <option value="116.3974,39.9093,1000">北京天安门</option>
                <option value="121.4737,31.2304,1000">上海外滩</option>
                <option value="113.2644,23.1291,1000">广州塔</option>
                <option value="114.1714,22.2793,1000">香港维多利亚港</option>
                <option value="87.6177,43.793,1000">乌鲁木齐</option>
              </select>
              <button id="flyToPresetBtn">飞行到预设位置</button>
            </div>
          </div>
        </div>
      </div>

      <div class="status" id="status">就绪</div>
    </div>
    <script>
      const { CameraUtils } = SunriseCesiumUtils;
      console.log("Cesium version:", Cesium, CameraUtils);
      Cesium.Ion.defaultAccessToken =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIyYmY4NjhkYy1kZThlLTQyOWMtOGYzNi04Yzk5Nzc1NDAxOTQiLCJpZCI6MzMyNDkzLCJpYXQiOjE3NTUzMzIwODZ9.myLWfCJ3Xijjw-bFY3mpV7hOHktDmvr6_AttNXN_pEY";
      // 初始化查看器
      const viewer = new Cesium.Viewer("cesiumContainer", {
        timeline: false,
        animation: false,
        baseLayerPicker: false,
        geocoder: false,
        homeButton: false,
        sceneModePicker: false,
        navigationHelpButton: false,
        fullscreenButton: false,
      });

      // 设置初始视角
      viewer.camera.setView({
        destination: Cesium.Cartesian3.fromDegrees(116.3974, 39.9093, 1500),
        orientation: {
          heading: 0,
          pitch: -Math.PI / 4,
          roll: 0,
        },
      });

      // 更新状态信息
      function updateStatus(message) {
        const statusEl = document.getElementById("status");
        statusEl.textContent = message;

        // 3秒后清除状态
        setTimeout(() => {
          if (statusEl.textContent === message) {
            statusEl.textContent = "就绪";
          }
        }, 3000);
      }

      // 飞行到指定位置测试
      document.getElementById("flyToBtn").addEventListener("click", () => {
        const lon = parseFloat(document.getElementById("flyLon").value);
        const lat = parseFloat(document.getElementById("flyLat").value);
        const height = parseFloat(document.getElementById("flyHeight").value);

        if (isNaN(lon) || isNaN(lat) || isNaN(height)) {
          updateStatus("请输入有效的经纬度和高度");
          return;
        }

        CameraUtils.flyToLonLat(viewer, lon, lat, height, {
          duration: 3,
          complete: () => updateStatus("飞行完成"),
        });

        updateStatus(`飞行到: 经度 ${lon}, 纬度 ${lat}, 高度 ${height}米`);
      });

      // 立即跳转到位置测试
      document.getElementById("setViewBtn").addEventListener("click", () => {
        const lon = parseFloat(document.getElementById("flyLon").value);
        const lat = parseFloat(document.getElementById("flyLat").value);
        const height = parseFloat(document.getElementById("flyHeight").value);

        if (isNaN(lon) || isNaN(lat) || isNaN(height)) {
          updateStatus("请输入有效的经纬度和高度");
          return;
        }

        const position = Cesium.Cartesian3.fromDegrees(lon, lat, height);
        CameraUtils.setView(viewer, position);

        updateStatus(`跳转到: 经度 ${lon}, 纬度 ${lat}, 高度 ${height}米`);
      });

      // 飞行到预设位置测试
      document
        .getElementById("flyToPresetBtn")
        .addEventListener("click", () => {
          const preset = document.getElementById("presetLocations").value;
          const [lon, lat, height] = preset.split(",").map(Number);

          CameraUtils.flyToLonLat(viewer, lon, lat, height, {
            duration: 3,
            complete: () =>
              updateStatus(
                `已到达${
                  document.getElementById("presetLocations").selectedOptions[0]
                    .text
                }`
              ),
          });

          updateStatus(
            `飞行到: ${
              document.getElementById("presetLocations").selectedOptions[0].text
            }`
          );
        });

      // 初始化完成
      updateStatus("相机控制测试页面已就绪");
    </script>
  </body>
</html>
